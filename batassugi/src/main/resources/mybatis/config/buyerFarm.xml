<?xml version="1.0" encoding="UTF-8"?>
<!-- Sql Mapper -->
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="buyerFarm">
  <resultMap type="rentVo" id="rentVoRM">
    <result column="cropsNo" property="cropsVo.cropsNo"/>
    <result column="cropsName" property="cropsVo.cropsName"/>
    <result column="cropsLevel" property="cropsVo.cropsLevel"/>
    <result column="recruitKind" property="recruitVo.recruitKind"  />
    <result column="recruitSize" property="recruitVo.recruitSize"/>
    <result column="name" property="recruitVo.farmVo.memberInfoVo.memberVo.name"/>
    <result column="farmAddress" property="recruitVo.farmVo.farmAddress"/>
  </resultMap>
  <select id="findRentFarmInfoById" resultMap="rentVoRM" parameterType="string">
    SELECT C.crops_no AS cropsNo, C.crops_name AS cropsName, 
    C.crops_level AS cropsLevel, R.recruit_kind AS recruitKind, 
    R.recruit_size AS recruitSize, F.farm_address AS farmAddress, 
    M.name AS name, RT.rent_no AS rentNo, RT. rent_size AS rentSize, 
    RT.rent_month AS rentMonth, RT.rent_status AS rentStatus, 
    to_char(RT.rent_startdate,'yy.mm.dd') AS rentStartdate,
    <!-- round(((sysdate-RT.rent_startdate)/(30*RT.rent_month))*100) as harvestStatus  -->
    round(((to_date('2018-06-24')-RT.rent_startdate)/(30*RT.rent_month))*100) as harvestStatus 
    FROM rent RT, recruit R, spider_member M, member_info I, farm F, crops C
    WHERE RT.recruit_no = R.recruit_no
    AND C.crops_no = RT.crops_no
    AND R.farm_no = F.farm_no 
    AND F.id = I.id 
    AND RT.id = M.id 
    AND RT.id = #{id}
    ORDER BY RT.rent_startdate DESC
  </select>
  <delete id="deleteRentByRentNo" parameterType="int">
    DELETE rent 
    WHERE rent_no = #{rentNo}
  </delete>
  <insert id="registerApplySeller" parameterType="applySellerVo">
    <selectKey resultType="string" keyProperty="applyNo" order="BEFORE">
      SELECT apply_fammer_SEQ.nextval 
      FROM dual
    </selectKey>
    INSERT INTO apply_seller(apply_no, id, farmer_document, apply_date, apply_reason)
    VALUES (#{applyNo}, #{memberVo.id}, #{farmerDocument}, sysdate, #{applyReason})
  </insert>
  <select id="findApplySellerById" resultType="applySellerVo" parameterType="string">
    SELECT farmer_document AS farmerDocument, apply_state AS applyState, 
    apply_reason AS applyReason, to_char(apply_date,'yy.mm.dd') AS applyDate
    FROM apply_seller
    WHERE id = #{id}
  </select>
</mapper>
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
















